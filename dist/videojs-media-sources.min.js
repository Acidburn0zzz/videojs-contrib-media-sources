/*! videojs-contrib-media-sources - v1.0.0 - 2015-09-01
* Copyright (c) 2015 Brightcove; Licensed  */
!function(a,b){var c=function(){this.init=function(){var a={};this.on=function(b,c){a[b]||(a[b]=[]),a[b].push(c)},this.off=function(b,c){var d;return a[b]?(d=a[b].indexOf(c),a[b].splice(d,1),d>-1):!1},this.trigger=function(b){var c,d,e,f;if(c=a[b])if(2===arguments.length)for(e=c.length,d=0;e>d;++d)c[d].call(this,arguments[1]);else{for(f=[],d=arguments.length,d=1;d<arguments.length;++d)f.push(arguments[d]);for(e=c.length,d=0;e>d;++d)c[d].apply(this,f)}},this.dispose=function(){a={}}}};c.prototype.pipe=function(a){return this.on("data",function(b){a.push(b)}),a},a.muxjs=a.muxjs||{},a.muxjs.Stream=c}(this),function(a,b){b.ExpGolomb=function(a){var b=a.byteLength,c=0,d=0;this.length=function(){return 8*b},this.bitsAvailable=function(){return 8*b+d},this.loadWord=function(){var e=a.byteLength-b,f=new Uint8Array(4),g=Math.min(4,b);if(0===g)throw new Error("no bytes available");f.set(a.subarray(e,e+g)),c=new DataView(f.buffer).getUint32(0),d=8*g,b-=g},this.skipBits=function(a){var e;d>a?(c<<=a,d-=a):(a-=d,e=Math.floor(a/8),a-=8*e,b-=e,this.loadWord(),c<<=a,d-=a)},this.readBits=function(a){var e=Math.min(d,a),f=c>>>32-e;return console.assert(32>a,"Cannot read more than 32 bits at a time"),d-=e,d>0?c<<=e:b>0&&this.loadWord(),e=a-e,e>0?f<<e|this.readBits(e):f},this.skipLeadingZeros=function(){var a;for(a=0;d>a;++a)if(0!==(c&2147483648>>>a))return c<<=a,d-=a,a;return this.loadWord(),a+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var a=this.skipLeadingZeros();return this.readBits(a+1)-1},this.readExpGolomb=function(){var a=this.readUnsignedExpGolomb();return 1&a?1+a>>>1:-1*(a>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()}}(this,this.muxjs),function(a){a.videojs=a.videojs||{},a.muxjs=a.muxjs||{};var b=a.muxjs;b.FlvTag=function(a,c){var d,e=0,f=function(a,b){var c,d=a.position+b;d<a.bytes.byteLength||(c=new Uint8Array(2*d),c.set(a.bytes.subarray(0,a.position),0),a.bytes=c,a.view=new DataView(a.bytes.buffer))},g=b.FlvTag.widthBytes||new Uint8Array("width".length),h=b.FlvTag.heightBytes||new Uint8Array("height".length),i=b.FlvTag.videocodecidBytes||new Uint8Array("videocodecid".length);if(!b.FlvTag.widthBytes){for(d=0;d<"width".length;d++)g[d]="width".charCodeAt(d);for(d=0;d<"height".length;d++)h[d]="height".charCodeAt(d);for(d=0;d<"videocodecid".length;d++)i[d]="videocodecid".charCodeAt(d);b.FlvTag.widthBytes=g,b.FlvTag.heightBytes=h,b.FlvTag.videocodecidBytes=i}switch(this.keyFrame=!1,a){case b.FlvTag.VIDEO_TAG:this.length=16;break;case b.FlvTag.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case b.FlvTag.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw"Error Unknown TagType"}this.bytes=new Uint8Array(16384),this.view=new DataView(this.bytes.buffer),this.bytes[0]=a,this.position=this.length,this.keyFrame=c,this.pts=0,this.dts=0,this.writeBytes=function(a,b,c){var d,e=b||0;c=c||a.byteLength,d=e+c,f(this,c),this.bytes.set(a.subarray(e,d),this.position),this.position+=c,this.length=Math.max(this.length,this.position)},this.writeByte=function(a){f(this,1),this.bytes[this.position]=a,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(a){f(this,2),this.view.setUint16(this.position,a),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(a){return this.bytes[this.length-a]},this.nalUnitSize=function(){return 0===e?0:this.length-(e+4)},this.startNalUnit=function(){if(e>0)throw new Error("Attempted to create new NAL wihout closing the old one");e=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(a){var b,c;this.length===e+4?this.length-=4:e>0&&(b=e+4,c=this.length-b,this.position=e,this.view.setUint32(this.position,c),this.position=this.length,a&&a.push(this.bytes.subarray(b,b+c))),e=0},this.writeMetaDataDouble=function(a,b){var c;if(f(this,2+a.length+9),this.view.setUint16(this.position,a.length),this.position+=2,"width"===a)this.bytes.set(g,this.position),this.position+=5;else if("height"===a)this.bytes.set(h,this.position),this.position+=6;else if("videocodecid"===a)this.bytes.set(i,this.position),this.position+=12;else for(c=0;c<a.length;c++)this.bytes[this.position]=a.charCodeAt(c),this.position++;this.position++,this.view.setFloat64(this.position,b),this.position+=8,this.length=Math.max(this.length,this.position),++e},this.writeMetaDataBoolean=function(a,b){var c;for(f(this,2),this.view.setUint16(this.position,a.length),this.position+=2,c=0;c<a.length;c++)console.assert(a.charCodeAt(c)<255),f(this,1),this.bytes[this.position]=a.charCodeAt(c),this.position++;f(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,b?1:0),this.position++,this.length=Math.max(this.length,this.position),++e},this.finalize=function(){var a,d;switch(this.bytes[0]){case b.FlvTag.VIDEO_TAG:this.bytes[11]=7|(this.keyFrame||c?16:32),this.bytes[12]=c?0:1,a=this.pts-this.dts,this.bytes[13]=(16711680&a)>>>16,this.bytes[14]=(65280&a)>>>8,this.bytes[15]=(255&a)>>>0;break;case b.FlvTag.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=c?0:1;break;case b.FlvTag.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,e),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position}return d=this.length-11,this.bytes[1]=(16711680&d)>>>16,this.bytes[2]=(65280&d)>>>8,this.bytes[3]=(255&d)>>>0,this.bytes[4]=(16711680&this.dts)>>>16,this.bytes[5]=(65280&this.dts)>>>8,this.bytes[6]=(255&this.dts)>>>0,this.bytes[7]=(4278190080&this.dts)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,f(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=b.FlvTag.frameTime(this.bytes),console.assert(this.bytes.byteLength===this.length),this}},b.FlvTag.AUDIO_TAG=8,b.FlvTag.VIDEO_TAG=9,b.FlvTag.METADATA_TAG=18,b.FlvTag.isAudioFrame=function(a){return b.FlvTag.AUDIO_TAG===a[0]},b.FlvTag.isVideoFrame=function(a){return b.FlvTag.VIDEO_TAG===a[0]},b.FlvTag.isMetaData=function(a){return b.FlvTag.METADATA_TAG===a[0]},b.FlvTag.isKeyFrame=function(a){return b.FlvTag.isVideoFrame(a)?23===a[11]:b.FlvTag.isAudioFrame(a)?!0:b.FlvTag.isMetaData(a)?!0:!1},b.FlvTag.frameTime=function(a){var b=a[4]<<16;return b|=a[5]<<8,b|=a[6]<<0,b|=a[7]<<24}}(this),function(a){var b=a.muxjs.FlvTag,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3];a.muxjs.AacStream=function(){var a,d,e,f,g,h,i,j,k,l,m,n,o;this.tags=[],this.setTimeStampOffset=function(a){f=a-1e3},this.setNextTimeStamp=function(b,c,f){a=b,e=c,f&&(d=0)},this.writeBytes=function(p,q,r){var s,t,u;for(q=q||0,r=r||0,r=r>e?e:r,e-=r,s=q+r;s>q;)switch(d){default:d=0;break;case 0:if(q>=s)return;if(255!==p[q])return console.assert(!1,"Error no ATDS header found"),q+=1,void(d=0);q+=1,d=1;break;case 1:if(q>=s)return;if(240!==(240&p[q]))return console.assert(!1,"Error no ATDS header found"),q+=1,void(d=0);g=!!(1&p[q]),q+=1,d=2;break;case 2:if(q>=s)return;h=((192&p[q])>>>6)+1,i=(60&p[q])>>>2,j=(1&p[q])<<2,q+=1,d=3;break;case 3:if(q>=s)return;j|=(192&p[q])>>>6,k=(3&p[q])<<11,q+=1,d=4;break;case 4:if(q>=s)return;k|=p[q]<<3,q+=1,d=5;break;case 5:if(q>=s)return;k|=(224&p[q])>>>5,k-=g?7:9,q+=1,d=6;break;case 6:if(q>=s)return;l=1024*((3&p[q])+1),m=1e3*l/c[i],t=h<<11|i<<7|j<<3,(t!==o||a-f>=1e3)&&(n=new b(b.METADATA_TAG),n.pts=a,n.dts=a,n.writeMetaDataDouble("audiocodecid",10),n.writeMetaDataBoolean("stereo",2===j),n.writeMetaDataDouble("audiosamplerate",c[i]),n.writeMetaDataDouble("audiosamplesize",16),this.tags.push(n),o=t,n=new b(b.AUDIO_TAG,!0),n.pts=a,n.dts=n.pts,n.view.setUint16(n.position,t),n.position+=2,n.length=Math.max(n.length,n.position),this.tags.push(n),f=a),q+=1,d=7;break;case 7:if(!g){if(2>s-q)return;q+=2}n=new b(b.AUDIO_TAG),n.pts=a,n.dts=a,d=8;break;case 8:for(;k;){if(q>=s)return;u=k>s-q?s-q:k,n.writeBytes(p,q,u),q+=u,k-=u}this.tags.push(n),d=0,a+=m}}}}(this),function(a){var b,c,d=a.muxjs.FlvTag,e=a.muxjs.H264ExtraData;a.muxjs.NALUnitType=c={unspecified:0,slice_layer_without_partitioning_rbsp_non_idr:1,slice_data_partition_a_layer_rbsp:2,slice_data_partition_b_layer_rbsp:3,slice_data_partition_c_layer_rbsp:4,slice_layer_without_partitioning_rbsp_idr:5,sei_rbsp:6,seq_parameter_set_rbsp:7,pic_parameter_set_rbsp:8,access_unit_delimiter_rbsp:9,end_of_seq_rbsp:10,end_of_stream_rbsp:11},a.muxjs.H264Stream=b=function(){this._next_pts=0,this._next_dts=0,this._h264Frame=null,this._oldExtraData=new e,this._newExtraData=new e,this._nalUnitType=-1,this._state=0,this.tags=[]},b.prototype.setTimeStampOffset=function(){},b.prototype.setNextTimeStamp=function(a,b,c){this._next_pts=a,this._next_dts=b,c&&this.finishFrame()},b.prototype.finishFrame=function(){this._h264Frame&&(this._newExtraData.extraDataExists()&&(this._oldExtraData=this._newExtraData,this._newExtraData=new e),this._oldExtraData.extraDataExists()&&(this._h264Frame.keyFrame||0===this.tags.length)&&(this.tags.push(this._oldExtraData.metaDataTag(this._h264Frame.pts)),this.tags.push(this._oldExtraData.extraDataTag(this._h264Frame.pts))),this._h264Frame.endNalUnit(),this.tags.push(this._h264Frame)),this._h264Frame=null,this._nalUnitType=-1,this._state=0},b.prototype.writeBytes=function(a,b,e){var f,g,h,i;if(b=b||0,e=e||0,!(0>=e))switch(this._state){default:case 0:this._state=1;case 1:if(a[b]<=1&&(f=this._h264Frame?this._h264Frame.nalUnitSize():0,f>=1&&0===this._h264Frame.negIndex(1))){if(1===a[b]&&f>=2&&0===this._h264Frame.negIndex(2))return f>=3&&0===this._h264Frame.negIndex(3)?this._h264Frame.length-=3:this._h264Frame.length-=2,this._state=3,this.writeBytes(a,b+1,e-1);if(e>1&&0===a[b]&&1===a[b+1])return f>=2&&0===this._h264Frame.negIndex(2)?this._h264Frame.length-=2:this._h264Frame.length-=1,this._state=3,this.writeBytes(a,b+2,e-2);if(e>2&&0===a[b]&&0===a[b+1]&&1===a[b+2])return this._state=3,this.writeBytes(a,b+3,e-3)}this._state=2;case 2:for(g=b,h=g+e,i=h-3;i>b;)if(a[b+2]>1)b+=3;else if(0!==a[b+1])b+=2;else if(0!==a[b])b+=1;else{if(1===a[b+2])return b>g&&this._h264Frame.writeBytes(a,g,b-g),this._state=3,b+=3,this.writeBytes(a,b,h-b);if(h-b>=4&&0===a[b+2]&&1===a[b+3])return b>g&&this._h264Frame.writeBytes(a,g,b-g),this._state=3,b+=4,this.writeBytes(a,b,h-b);b+=3}return this._state=1,void(this._h264Frame&&this._h264Frame.writeBytes(a,g,e));case 3:if(this._h264Frame)switch(this._nalUnitType){case c.seq_parameter_set_rbsp:this._h264Frame.endNalUnit(this._newExtraData.sps);break;case c.pic_parameter_set_rbsp:this._h264Frame.endNalUnit(this._newExtraData.pps);break;case c.slice_layer_without_partitioning_rbsp_idr:this._h264Frame.endNalUnit();break;default:this._h264Frame.endNalUnit()}return this._nalUnitType=31&a[b],this._h264Frame&&(this._nalUnitType===c.access_unit_delimiter_rbsp?this.finishFrame():this._nalUnitType===c.slice_layer_without_partitioning_rbsp_idr&&(this._h264Frame.keyFrame=!0)),this._h264Frame||(this._h264Frame=new d(d.VIDEO_TAG),this._h264Frame.pts=this._next_pts,this._h264Frame.dts=this._next_dts),this._h264Frame.startNalUnit(),this._state=2,this.writeBytes(a,b,e)}}}(this),function(a,b,c){"use strict";var d,e=function(a,b,c){var d,e="";for(d=b;c>d;d++)e+="%"+("00"+a[d].toString(16)).slice(-2);return e},f=function(b,c,d){return a.decodeURIComponent(e(b,c,d))},g=function(b,c,d){return a.unescape(e(b,c,d))},h={TXXX:function(a){var b;if(3===a.data[0])for(b=1;b<a.data.length;b++)if(0===a.data[b]){a.description=f(a.data,1,b),a.value=f(a.data,b+1,a.data.length-1);break}},WXXX:function(a){var b;if(3===a.data[0])for(b=1;b<a.data.length;b++)if(0===a.data[b]){a.description=f(a.data,1,b),a.url=f(a.data,b+1,a.data.length);break}},PRIV:function(a){var b;for(b=0;b<a.data.length;b++)if(0===a.data[b]){a.owner=g(a.data,0,b);break}a.privateData=a.data.subarray(b+1)}};d=function(a){var c,e={debug:!(!a||!a.debug),descriptor:a&&a.descriptor},f=0,g=[],i=0;if(d.prototype.init.call(this),this.dispatchType=b.SegmentParser.STREAM_TYPES.metadata.toString(16),e.descriptor)for(c=0;c<e.descriptor.length;c++)this.dispatchType+=("00"+e.descriptor[c].toString(16)).slice(-2);this.push=function(a){var b,c,d,j,k;if(0===g.length&&(a.data.length<10||a.data[0]!=="I".charCodeAt(0)||a.data[1]!=="D".charCodeAt(0)||a.data[2]!=="3".charCodeAt(0)))return void(e.debug&&console.log("Skipping unrecognized metadata packet"));if(g.push(a),i+=a.data.byteLength,1===g.length&&(f=a.data[6]<<21|a.data[7]<<14|a.data[8]<<7|a.data[9],f+=10),!(f>i)){for(b={data:new Uint8Array(f),frames:[],pts:g[0].pts,dts:g[0].dts},k=0;f>k;)b.data.set(g[0].data,k),k+=g[0].data.byteLength,i-=g[0].data.byteLength,g.shift();c=10,64&b.data[5]&&(c+=4,c+=b.data[10]<<24|b.data[11]<<16|b.data[12]<<8|b.data[13],f-=b.data[16]<<24|b.data[17]<<16|b.data[18]<<8|b.data[19]);do{if(d=b.data[c+4]<<24|b.data[c+5]<<16|b.data[c+6]<<8|b.data[c+7],1>d)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");j={id:String.fromCharCode(b.data[c],b.data[c+1],b.data[c+2],b.data[c+3]),data:b.data.subarray(c+10,c+d+10)},h[j.id]&&h[j.id](j),b.frames.push(j),c+=10,c+=d}while(f>c);this.trigger("data",b)}}},d.prototype=new b.Stream,b.MetadataStream=d}(window,window.muxjs),function(){var a,b=window.muxjs.ExpGolomb,c=window.muxjs.FlvTag;window.muxjs.H264ExtraData=a=function(){this.sps=[],this.pps=[]},a.prototype.extraDataExists=function(){return this.sps.length>0},a.prototype.scaling_list=function(a,b){var c,d,e=8,f=8;for(c=0;a>c;++c)0!==f&&(d=b.readExpGolomb(),f=(e+d+256)%256),e=0===f?e:f},a.prototype.getSps0Rbsp=function(){for(var a=this.sps[0],b=1,c=1,d=0,e=a.byteLength-2,f=new Uint8Array(a.byteLength);e>b;)0===a[b]&&0===a[b+1]&&3===a[b+2]&&(f.set(a.subarray(c,b+1),d),d+=b+1-c,c=b+3),b++;return f.set(a.subarray(c),d),f.subarray(0,d+(a.byteLength-c))},a.prototype.metaDataTag=function(a){var d,e,f,g,h,i,j,k,l,m,n,o,p,q=new c(c.METADATA_TAG),r=0,s=0,t=0,u=0;if(q.dts=a,q.pts=a,d=new b(this.getSps0Rbsp()),e=d.readUnsignedByte(),d.skipBits(16),d.skipUnsignedExpGolomb(),(100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e)&&(f=d.readUnsignedExpGolomb(),3===f&&d.skipBits(1),d.skipUnsignedExpGolomb(),d.skipUnsignedExpGolomb(),d.skipBits(1),d.readBoolean()))for(g=3!==f?8:12,h=0;g>h;++h)d.readBoolean()&&(6>h?this.scaling_list(16,d):this.scaling_list(64,d));if(d.skipUnsignedExpGolomb(),i=d.readUnsignedExpGolomb(),0===i)d.readUnsignedExpGolomb();else if(1===i)for(d.skipBits(1),d.skipExpGolomb(),d.skipExpGolomb(),j=d.readUnsignedExpGolomb(),h=0;j>h;++h)d.skipExpGolomb();return d.skipUnsignedExpGolomb(),d.skipBits(1),k=d.readUnsignedExpGolomb(),l=d.readUnsignedExpGolomb(),m=d.readBits(1),0===m&&d.skipBits(1),d.skipBits(1),n=d.readBoolean(),n&&(r=d.readUnsignedExpGolomb(),s=d.readUnsignedExpGolomb(),t=d.readUnsignedExpGolomb(),u=d.readUnsignedExpGolomb()),o=16*(k+1)-2*r-2*s,p=(2-m)*(l+1)*16-2*t-2*u,q.writeMetaDataDouble("videocodecid",7),q.writeMetaDataDouble("width",o),q.writeMetaDataDouble("height",p),q},a.prototype.extraDataTag=function(a){var b,d=new c(c.VIDEO_TAG,!0);for(d.dts=a,d.pts=a,d.writeByte(1),d.writeByte(this.sps[0][1]),d.writeByte(this.sps[0][2]),d.writeByte(this.sps[0][3]),d.writeByte(255),d.writeByte(225),d.writeShort(this.sps[0].length),d.writeBytes(this.sps[0]),d.writeByte(this.pps.length),b=0;b<this.pps.length;++b)d.writeShort(this.pps[b].length),d.writeBytes(this.pps[b]);return d}}(),function(a){var b,c,d=muxjs.FlvTag,e=muxjs.H264Stream,f=muxjs.AacStream,g=muxjs.MetadataStream;muxjs.SegmentParser=function(){var a,h=this,i=new Uint8Array(b),j=0,k=new e,l=new f;h.stream={programMapTable:{}},h.metadataStream=new g,h.getFlvHeader=function(a,b,c){var e,f,g,h=new Uint8Array(9),i=new DataView(h.buffer);return a=a||0,b=void 0===b?!0:b,c=void 0===c?!0:c,i.setUint8(0,70),i.setUint8(1,76),i.setUint8(2,86),i.setUint8(3,1),i.setUint8(4,(b?4:0)|(c?1:0)),i.setUint32(5,h.byteLength),0>=a?(f=new Uint8Array(h.byteLength+4),f.set(h),f.set([0,0,0,0],h.byteLength),f):(e=new d(d.METADATA_TAG),e.pts=e.dts=0,e.writeMetaDataDouble("duration",a),g=e.finalize().length,f=new Uint8Array(h.byteLength+g),f.set(h),f.set(i.byteLength,g),f)},h.flushTags=function(){k.finishFrame()},h.tagsAvailable=function(){return k.tags.length+l.tags.length},h.getNextTag=function(){var a;return a=k.tags.length?l.tags.length&&l.tags[0].dts<k.tags[0].dts?l.tags.shift():k.tags.shift():l.tags.shift(),a.finalize()},h.parseSegmentBinaryData=function(c){var d,e=0;if(j>0){if(c.byteLength+j<b)return console.log("data.length + streamBuffer.length < MP2T_PACKET_LENGTH ??"),void i.readBytes(c,c.length,i.length);d=c.subarray(0,b-j),i.set(d,j),a(i),i=new Uint8Array(b),j=0}for(;;){for(;e<c.byteLength&&71!==c[e];)e++;if(c.byteLength-e<b)return void(c.byteLength-e>0&&(i.set(c.subarray(e),j),j+=c.byteLength-e));a(c.subarray(e,e+b))?e+=b:(console.log("error parsing m2ts packet, attempting to re-align"),e++)}},a=function(a){var d,e,f,g,i,j,m,n,o,p,q,r,s,t,u,v,w,x,y=0,z=y+b,A=!!(64&a[y+1]),B=(31&a[y+1])<<8|a[y+2],C=(48&a[y+3])>>>4;if(y+=4,C>1&&(y+=a[y]+1),0===B){if(A&&(y+=1+a[y]),d=a[y],0!==d&&console.log("the table_id of the PAT should be 0x00 but was"+d.toString(16)),e=!!(1&a[y+5]))for(f=(15&a[y+1])<<8|a[y+2],y+=8,j=y+(f-5-4);j>y;y+=4)if(g=a[y]<<8|a[y+1],i=(31&a[y+2])<<8|a[y+3],0===g)h.stream.networkPid=i;else if(void 0===h.stream.pmtPid)h.stream.pmtPid=i;else if(h.stream.pmtPid!==i)throw new Error("TS has more that 1 program")}else if(B===h.stream.programMapTable[c.h264]||B===h.stream.programMapTable[c.adts]||B===h.stream.programMapTable[c.metadata]){if(A){if(0!==a[y+0]||0!==a[y+1]||1!==a[y+2])throw new Error("PES did not begin with start code");m=a[y+4]<<8|a[y+5],n=0!==(4&a[y+6]),o=a[y+7],p=a[y+8],y+=9,192&o&&(q=(14&a[y+0])<<28|(255&a[y+1])<<21|(254&a[y+2])<<13|(255&a[y+3])<<6|(254&a[y+4])>>>2,q/=45,r=q,64&o&&(r=(14&a[y+5])<<28|(255&a[y+6])<<21|(254&a[y+7])<<13|(255&a[y+8])<<6|(254&a[y+9])>>>2,r/=45)),y+=p,B===h.stream.programMapTable[c.h264]?k.setNextTimeStamp(q,r,n):B===h.stream.programMapTable[c.adts]&&l.setNextTimeStamp(q,m,n)}B===h.stream.programMapTable[c.adts]?l.writeBytes(a,y,z-y):B===h.stream.programMapTable[c.h264]?k.writeBytes(a,y,z-y):B===h.stream.programMapTable[c.metadata]&&h.metadataStream.push({pts:q,dts:r,data:a.subarray(y)})}else if(h.stream.pmtPid===B){if(A&&(y+=1+a[y]),2!==a[y]&&console.log("The table_id of a PMT should be 0x02 but was "+a[y].toString(16)),s=!!(1&a[y+5]))for(h.stream.programMapTable={},u=(15&a[y+1])<<8|a[y+2],t=(15&a[y+10])<<8|a[y+11],u-=t,u-=13,h.stream.programMapTable.pcrPid=(31&a[y+8])<<8|a[y+9],y+=12+t;u>0;){if(v=a[y+0],w=(31&a[y+1])<<8|a[y+2],v===c.h264&&h.stream.programMapTable[v]&&h.stream.programMapTable[v]!==w)throw new Error("Program has more than 1 video stream");if(v===c.adts&&h.stream.programMapTable[v]&&h.stream.programMapTable[v]!==w)throw new Error("Program has more than 1 audio Stream");h.stream.programMapTable[v]=w,x=(15&a[y+3])<<8|a[y+4],v===c.metadata&&(h.metadataStream.descriptor=new Uint8Array(a.subarray(y+5,y+5+x))),y+=5+x,u-=5+x}}else h.stream.networkPid===B||17===B||8191===B||h.stream.programMapTable.pcrPid||console.log("Unknown PID parsing TS packet: "+B);return!0},h.getTags=function(){return k.tags},h.stats={h264Tags:function(){return k.tags.length},minVideoPts:function(){return k.tags[0].pts},maxVideoPts:function(){return k.tags[k.tags.length-1].pts},aacTags:function(){return l.tags.length},minAudioPts:function(){return l.tags[0].pts},maxAudioPts:function(){return l.tags[l.tags.length-1].pts}}},muxjs.SegmentParser.MP2T_PACKET_LENGTH=b=188,muxjs.SegmentParser.STREAM_TYPES=c={h264:27,adts:15,metadata:21}}(window),function(a,b,c){"use strict";var d,e,f,g,h,i=0,j=videojs.EventTarget,k="blob:vjs-media-source/";d={mode:"auto"},videojs.MediaSource=videojs["extends"](j,{constructor:function(b){var c;return this.settings_=videojs.mergeOptions(d,b),"auto"===this.settings_.mode&&videojs.MediaSource.supportsNativeMediaSources()||"html5"===this.settings_.mode?(c=new a.MediaSource,f(c),c):new videojs.FlashMediaSource}}),videojs.MediaSource.supportsNativeMediaSources=function(){return!!a.MediaSource},f=function(a){a.virtualBuffers=[],a.addSourceBuffer_=a.addSourceBuffer,a.addSourceBuffer=g},g=function(a){var b;return"video/mp2t"===a?(b=new e(this),this.virtualBuffers.push(b),b):this.addSourceBuffer_(a)},e=videojs["extends"](j,{constructor:function(a){var b=this;this.pendingBuffers_=[],this.bufferUpdating_=!1,this.transmuxer_=new Worker(URL.createObjectURL(new Blob(['var muxjs={};!function(a,b){b.ExpGolomb=function(a){var b=a.byteLength,c=0,d=0;this.length=function(){return 8*b},this.bitsAvailable=function(){return 8*b+d},this.loadWord=function(){var e=a.byteLength-b,f=new Uint8Array(4),g=Math.min(4,b);if(0===g)throw new Error("no bytes available");f.set(a.subarray(e,e+g)),c=new DataView(f.buffer).getUint32(0),d=8*g,b-=g},this.skipBits=function(a){var e;d>a?(c<<=a,d-=a):(a-=d,e=Math.floor(a/8),a-=8*e,b-=e,this.loadWord(),c<<=a,d-=a)},this.readBits=function(a){var e=Math.min(d,a),f=c>>>32-e;return console.assert(32>a,"Cannot read more than 32 bits at a time"),d-=e,d>0?c<<=e:b>0&&this.loadWord(),e=a-e,e>0?f<<e|this.readBits(e):f},this.skipLeadingZeros=function(){var a;for(a=0;d>a;++a)if(0!==(c&2147483648>>>a))return c<<=a,d-=a,a;return this.loadWord(),a+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var a=this.skipLeadingZeros();return this.readBits(a+1)-1},this.readExpGolomb=function(){var a=this.readUnsignedExpGolomb();return 1&a?1+a>>>1:-1*(a>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()}}(this,this.muxjs),function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P;O=a.Uint8Array,P=a.DataView,function(){var a;A={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]};for(a in A)A.hasOwnProperty(a)&&(A[a]=[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)]);B=new O(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),D=new O(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),C=new O([0,0,0,1]),E=new O([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),F=new O([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),G={video:E,audio:F},J=new O([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),I=new O([0,0,0,0,0,0,0,0]),K=new O([0,0,0,0,0,0,0,0]),L=K,M=new O([0,0,0,0,0,0,0,0,0,0,0,0]),N=K,H=new O([0,0,0,1,0,0,0,0,0,0,0,0])}(),d=function(a){var b,c,d,e=[],f=0;for(b=1;b<arguments.length;b++)e.push(arguments[b]);for(b=e.length;b--;)f+=e[b].byteLength;for(c=new O(f+8),d=new P(c.buffer,c.byteOffset,c.byteLength),d.setUint32(0,c.byteLength),c.set(a,4),b=0,f=8;b<e.length;b++)c.set(e[b],f),f+=e[b].byteLength;return c},e=function(){return d(A.dinf,d(A.dref,J))},f=function(a){return d(A.esds,new O([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,a.audioobjecttype<<3|a.samplingfrequencyindex>>>1,a.samplingfrequencyindex<<7|a.channelcount<<3,6,1,2]))},g=function(){return d(A.ftyp,B,C,B,D)},s=function(a){return d(A.hdlr,G[a])},h=function(a){return d(A.mdat,a)},r=function(a){var b=new O([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,a.duration>>>24&255,a.duration>>>16&255,a.duration>>>8&255,255&a.duration,85,196,0,0]);return a.samplerate&&(b[12]=a.samplerate>>>24&255,b[13]=a.samplerate>>>16&255,b[14]=a.samplerate>>>8&255,b[15]=255&a.samplerate),d(A.mdhd,b)},q=function(a){return d(A.mdia,r(a),s(a.type),j(a))},i=function(a){return d(A.mfhd,new O([0,0,0,0,(4278190080&a)>>24,(16711680&a)>>16,(65280&a)>>8,255&a]))},j=function(a){return d(A.minf,"video"===a.type?d(A.vmhd,H):d(A.smhd,I),e(),u(a))},k=function(a,b){for(var c=[],e=b.length;e--;)c[e]=x(b[e]);return d.apply(null,[A.moof,i(a)].concat(c))},l=function(a){for(var b=a.length,c=[];b--;)c[b]=o(a[b]);return d.apply(null,[A.moov,n(4294967295)].concat(c).concat(m(a)))},m=function(a){for(var b=a.length,c=[];b--;)c[b]=y(a[b]);return d.apply(null,[A.mvex].concat(c))},n=function(a){var b=new O([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&a)>>24,(16711680&a)>>16,(65280&a)>>8,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return d(A.mvhd,b)},t=function(a){var b,c,e=a.samples||[],f=new O(4+e.length);for(c=0;c<e.length;c++)b=e[c].flags,f[c+4]=b.dependsOn<<4|b.isDependedOn<<2|b.hasRedundancy;return d(A.sdtp,f)},u=function(a){return d(A.stbl,v(a),d(A.stts,N),d(A.stsc,L),d(A.stsz,M),d(A.stco,K))},function(){var a,b;v=function(c){return d(A.stsd,new O([0,0,0,0,0,0,0,1]),"video"===c.type?a(c):b(c))},a=function(a){var b,c=a.sps||[],e=a.pps||[],f=[],g=[];for(b=0;b<c.length;b++)f.push((65280&c[b].byteLength)>>>8),f.push(255&c[b].byteLength),f=f.concat(Array.prototype.slice.call(c[b]));for(b=0;b<e.length;b++)g.push((65280&e[b].byteLength)>>>8),g.push(255&e[b].byteLength),g=g.concat(Array.prototype.slice.call(e[b]));return d(A.avc1,new O([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&a.width)>>8,255&a.width,(65280&a.height)>>8,255&a.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d(A.avcC,new O([1,a.profileIdc,a.profileCompatibility,a.levelIdc,255].concat([c.length]).concat(f).concat([e.length]).concat(g))),d(A.btrt,new O([0,28,156,128,0,45,198,192,0,45,198,192])))},b=function(a){return d(A.mp4a,new O([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&a.channelcount)>>8,255&a.channelcount,(65280&a.samplesize)>>8,255&a.samplesize,0,0,0,0,(65280&a.samplerate)>>8,255&a.samplerate,0,0]),f(a))}}(),w=function(){return d(A.styp,B,C,B)},p=function(a){var b=new O([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&a.id)>>24,(16711680&a.id)>>16,(65280&a.id)>>8,255&a.id,0,0,0,0,(4278190080&a.duration)>>24,(16711680&a.duration)>>16,(65280&a.duration)>>8,255&a.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&a.width)>>8,255&a.width,0,0,(65280&a.height)>>8,255&a.height,0,0]);return d(A.tkhd,b)},x=function(a){var b,c,e,f,g;return b=d(A.tfhd,new O([0,0,0,58,(4278190080&a.id)>>24,(16711680&a.id)>>16,(65280&a.id)>>8,255&a.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),c=d(A.tfdt,new O([0,0,0,0,a.baseMediaDecodeTime>>>24&255,a.baseMediaDecodeTime>>>16&255,a.baseMediaDecodeTime>>>8&255,255&a.baseMediaDecodeTime])),g=88,"audio"===a.type?(e=z(a,g),d(A.traf,b,c,e)):(f=t(a),e=z(a,f.length+g),d(A.traf,b,c,e,f))},o=function(a){return a.duration=a.duration||4294967295,d(A.trak,p(a),q(a))},y=function(a){var b=new O([0,0,0,0,(4278190080&a.id)>>24,(16711680&a.id)>>16,(65280&a.id)>>8,255&a.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==a.type&&(b[b.length-1]=0),d(A.trex,b)},function(){var a,b,e;e=function(a,b){var d=0,e=0,f=0,g=0;return a.length&&(a[0].duration!==c&&(d=1),a[0].size!==c&&(e=2),a[0].flags!==c&&(f=4),a[0].compositionTimeOffset!==c&&(g=8)),[0,0,d|e|f|g,1,(4278190080&a.length)>>>24,(16711680&a.length)>>>16,(65280&a.length)>>>8,255&a.length,(4278190080&b)>>>24,(16711680&b)>>>16,(65280&b)>>>8,255&b]},b=function(a,b){var c,f,g,h;for(f=a.samples||[],b+=20+16*f.length,c=e(f,b),h=0;h<f.length;h++)g=f[h],c=c.concat([(4278190080&g.duration)>>>24,(16711680&g.duration)>>>16,(65280&g.duration)>>>8,255&g.duration,(4278190080&g.size)>>>24,(16711680&g.size)>>>16,(65280&g.size)>>>8,255&g.size,g.flags.isLeading<<2|g.flags.dependsOn,g.flags.isDependedOn<<6|g.flags.hasRedundancy<<4|g.flags.paddingValue<<1|g.flags.isNonSyncSample,61440&g.flags.degradationPriority,15&g.flags.degradationPriority,(4278190080&g.compositionTimeOffset)>>>24,(16711680&g.compositionTimeOffset)>>>16,(65280&g.compositionTimeOffset)>>>8,255&g.compositionTimeOffset]);return d(A.trun,new O(c))},a=function(a,b){var c,f,g,h;for(f=a.samples||[],b+=20+8*f.length,c=e(f,b),h=0;h<f.length;h++)g=f[h],c=c.concat([(4278190080&g.duration)>>>24,(16711680&g.duration)>>>16,(65280&g.duration)>>>8,255&g.duration,(4278190080&g.size)>>>24,(16711680&g.size)>>>16,(65280&g.size)>>>8,255&g.size]);return d(A.trun,new O(c))},z=function(c,d){return"audio"===c.type?a(c,d):b(c,d)}}(),b.mp4={ftyp:g,mdat:h,moof:k,moov:l,initSegment:function(a){var b,c=g(),d=l(a);return b=new O(c.byteLength+d.byteLength),b.set(c),b.set(d,c.byteLength),b}}}(this,this.muxjs),function(a,b){var c=function(){this.init=function(){var a={};this.on=function(b,c){a[b]||(a[b]=[]),a[b].push(c)},this.off=function(b,c){var d;return a[b]?(d=a[b].indexOf(c),a[b].splice(d,1),d>-1):!1},this.trigger=function(b){var c,d,e,f;if(c=a[b])if(2===arguments.length)for(e=c.length,d=0;e>d;++d)c[d].call(this,arguments[1]);else{for(f=[],d=arguments.length,d=1;d<arguments.length;++d)f.push(arguments[d]);for(e=c.length,d=0;e>d;++d)c[d].apply(this,f)}},this.dispose=function(){a={}}}};c.prototype.pipe=function(a){return this.on("data",function(b){a.push(b)}),a},a.muxjs=a.muxjs||{},a.muxjs.Stream=c}(this),function(a,b,c){"use strict";var d,e=function(a,b,c){var d,e="";for(d=b;c>d;d++)e+="%"+("00"+a[d].toString(16)).slice(-2);return e},f=function(b,c,d){return a.decodeURIComponent(e(b,c,d))},g=function(b,c,d){return a.unescape(e(b,c,d))},h={TXXX:function(a){var b;if(3===a.data[0])for(b=1;b<a.data.length;b++)if(0===a.data[b]){a.description=f(a.data,1,b),a.value=f(a.data,b+1,a.data.length-1);break}},WXXX:function(a){var b;if(3===a.data[0])for(b=1;b<a.data.length;b++)if(0===a.data[b]){a.description=f(a.data,1,b),a.url=f(a.data,b+1,a.data.length);break}},PRIV:function(a){var b;for(b=0;b<a.data.length;b++)if(0===a.data[b]){a.owner=g(a.data,0,b);break}a.privateData=a.data.subarray(b+1)}};d=function(a){var c,e={debug:!(!a||!a.debug),descriptor:a&&a.descriptor},f=0,g=[],i=0;if(d.prototype.init.call(this),this.dispatchType=b.mp2t.METADATA_STREAM_TYPE.toString(16),e.descriptor)for(c=0;c<e.descriptor.length;c++)this.dispatchType+=("00"+e.descriptor[c].toString(16)).slice(-2);this.push=function(a){var b,c,d,j,k;if("timed-metadata"===a.type){if(0===g.length&&(a.data.length<10||a.data[0]!=="I".charCodeAt(0)||a.data[1]!=="D".charCodeAt(0)||a.data[2]!=="3".charCodeAt(0)))return void(e.debug&&console.log("Skipping unrecognized metadata packet"));if(g.push(a),i+=a.data.byteLength,1===g.length&&(f=a.data[6]<<21|a.data[7]<<14|a.data[8]<<7|a.data[9],f+=10),!(f>i)){for(b={data:new Uint8Array(f),frames:[],pts:g[0].pts,dts:g[0].dts},k=0;f>k;)b.data.set(g[0].data,k),k+=g[0].data.byteLength,i-=g[0].data.byteLength,g.shift();c=10,64&b.data[5]&&(c+=4,c+=b.data[10]<<24|b.data[11]<<16|b.data[12]<<8|b.data[13],f-=b.data[16]<<24|b.data[17]<<16|b.data[18]<<8|b.data[19]);do{if(d=b.data[c+4]<<24|b.data[c+5]<<16|b.data[c+6]<<8|b.data[c+7],1>d)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");j={id:String.fromCharCode(b.data[c],b.data[c+1],b.data[c+2],b.data[c+3]),data:b.data.subarray(c+10,c+d+10)},h[j.id]&&h[j.id](j),b.frames.push(j),c+=10,c+=d}while(f>c);this.trigger("data",b)}}}},d.prototype=new b.Stream,b.mp2t=b.mp2t||{},b.mp2t.MetadataStream=d}(this,this.muxjs),function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;p=188,q=27,r=15,s=21,t=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],u=b.mp4,d=function(){var a=new Uint8Array(p),b=0;d.prototype.init.call(this),this.push=function(c){var d,e;if(b>0){if(d=p-b,a.set(c.subarray(0,d),b),c.byteLength<d)return void(b+=c.byteLength);c=c.subarray(d),b=0,this.trigger("data",a)}if(c.byteLength<p)return a.set(c.subarray(e),b),void(b+=c.byteLength);e=0;do this.trigger("data",c.subarray(e,e+p)),e+=p,d=c.byteLength-e;while(e<c.byteLength&&d>=p);d>0&&(a.set(c.subarray(e)),b=d)}},d.prototype=new b.Stream,e=function(){var a,b,c,d,f;e.prototype.init.call(this),f=this,this.programMapTable={},a=function(a,d){var e=0;d.payloadUnitStartIndicator&&(e+=a[e]+1),"pat"===d.type?b(a.subarray(e),d):c(a.subarray(e),d)},b=function(a,b){b.section_number=a[7],b.last_section_number=a[8],f.pmtPid=(31&a[10])<<8|a[11],b.pmtPid=f.pmtPid},c=function(a,b){var c,d,e,g;if(1&a[5]){for(f.programMapTable={},c=(15&a[1])<<8|a[2],d=3+c-4,e=(15&a[10])<<8|a[11],g=12+e;d>g;)f.programMapTable[(31&a[g+1])<<8|a[g+2]]=a[g],g+=((15&a[g+3])<<8|a[g+4])+5;b.programMapTable=f.programMapTable}},d=function(a,b){var c;return b.payloadUnitStartIndicator?(b.dataAlignmentIndicator=0!==(4&a[6]),c=a[7],192&c&&(b.pts=(14&a[9])<<28|(255&a[10])<<21|(254&a[11])<<13|(255&a[12])<<6|(254&a[13])>>>2,b.pts*=2,b.pts+=2&a[13],b.dts=b.pts,64&c&&(b.dts=(14&a[14])<<28|(255&a[15])<<21|(254&a[16])<<13|(255&a[17])<<6|(254&a[18])>>>2,b.dts*=2,b.dts+=2&a[18])),void(b.data=a.subarray(9+a[8]))):void(b.data=a)},this.push=function(b){var c={},e=4;return 71!==b[0]?this.trigger("error","mis-aligned packet"):(c.payloadUnitStartIndicator=!!(64&b[1]),c.pid=31&b[1],c.pid<<=8,c.pid|=b[2],(48&b[3])>>>4>1&&(e+=b[e]+1),0===c.pid?(c.type="pat",a(b.subarray(e),c)):c.pid===this.pmtPid?(c.type="pmt",a(b.subarray(e),c)):(c.streamType=this.programMapTable[c.pid],c.type="pes",d(b.subarray(e),c)),void this.trigger("data",c))}},e.prototype=new b.Stream,e.STREAM_TYPES={h264:27,adts:15},f=function(){var a,b={data:[],size:0},c={data:[],size:0},d={data:[],size:0},e=function(b,c){var d,e={type:c,data:new Uint8Array(b.size)},f=0;if(b.data.length){for(e.trackId=b.data[0].pid,e.pts=b.data[0].pts,e.dts=b.data[0].dts;b.data.length;)d=b.data.shift(),e.data.set(d.data,f),f+=d.data.byteLength;b.size=0,a.trigger("data",e)}};f.prototype.init.call(this),a=this,this.push=function(f){({pat:function(){},pes:function(){var a,g;switch(f.streamType){case q:a=b,g="video";break;case r:a=c,g="audio";break;case s:a=d,g="timed-metadata";break;default:return}f.payloadUnitStartIndicator&&e(a,g),a.data.push(f),a.size+=f.data.byteLength},pmt:function(){var b,c,d={type:"metadata",tracks:[]},e=f.programMapTable;for(b in e)e.hasOwnProperty(b)&&(c={},c.id=+b,e[b]===q?(c.codec="avc",c.type="video"):e[b]===r&&(c.codec="adts",c.type="audio"),d.tracks.push(c));a.trigger("data",d)}})[f.type]()},this.flush=function(){e(b,"video"),e(c,"audio"),e(d,"timed-metadata")}},f.prototype=new b.Stream,j=function(){var a,b,c=1;j.prototype.init.call(this),a=this,this.push=function(a){var d,e;if("audio"===a.type)for(b=a.data;c+4<b.length;)e=2*(1&~b[c]),d=(3&b[c+2])<<11|b[c+3]<<3|(224&b[c+4])>>5,this.trigger("data",{dts:a.dts,audioobjecttype:(b[c+1]>>>6&3)+1,channelcount:(1&b[c+1])<<3|(192&b[c+2])>>>6,samplerate:t[(60&b[c+1])>>>2],samplingfrequencyindex:(60&b[c+1])>>>2,samplesize:16,data:b.subarray(c+6+e,c+d-1)}),b=b.subarray(c+d-1),c=1}},j.prototype=new b.Stream,h=function(a){var b=[],d=0,e=0;h.prototype.init.call(this),this.push=function(e){m(a,e),a&&a.channelcount===c&&(a.audioobjecttype=e.audioobjecttype,a.channelcount=e.channelcount,a.samplerate=e.samplerate,a.samplingfrequencyindex=e.samplingfrequencyindex,a.samplesize=e.samplesize),b.push(e),d+=e.data.byteLength},this.flush=function(){var c,f,g,h,i,j,k;if(0!==d){for(g=new Uint8Array(d),a.samples=[],i=0;b.length;)f=b[0],h={size:f.data.byteLength,duration:1024},a.samples.push(h),g.set(f.data,i),i+=f.data.byteLength,b.shift();d=0,j=u.mdat(g),o(a),k=u.moof(e,[a]),c=new Uint8Array(k.byteLength+j.byteLength),e++,c.set(k),c.set(j,k.byteLength),n(a),this.trigger("data",{track:a,boxes:c})}}},h.prototype=new b.Stream,l=function(){var a,b,c=1;l.prototype.init.call(this),this.push=function(d){var e;for(b?(e=new Uint8Array(b.byteLength+d.data.byteLength),e.set(b),e.set(d.data,b.byteLength),b=e):b=d.data;c<b.byteLength-3;c++)if(1===b[c+2]){a=c+5;break}for(;a<b.byteLength;)switch(b[a]){case 0:if(0!==b[a-1]){a+=2;break}if(0!==b[a-2]){a++;break}this.trigger("data",b.subarray(c+3,a-2));do a++;while(1!==b[a]&&a<b.length);c=a-2,a+=3;break;case 1:if(0!==b[a-1]||0!==b[a-2]){a+=3;break}this.trigger("data",b.subarray(c+3,a-2)),c=a-2,a+=3;break;default:a+=3}b=b.subarray(c),a-=c,c=0},this.flush=function(){b&&b.byteLength>3&&this.trigger("data",b.subarray(c+3)),b=null,c=1}},l.prototype=new b.Stream,k=function(){var a,c,d,e,f,g,h,i=new l;k.prototype.init.call(this),a=this,this.push=function(a){"video"===a.type&&(c=a.trackId,d=a.pts,e=a.dts,i.push(a))},i.on("data",function(b){var h={trackId:c,pts:d,dts:e,data:b};switch(31&b[0]){case 5:h.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 7:h.nalUnitType="seq_parameter_set_rbsp",h.escapedRBSP=f(b.subarray(1)),h.config=g(h.escapedRBSP);break;case 8:h.nalUnitType="pic_parameter_set_rbsp";break;case 9:h.nalUnitType="access_unit_delimiter_rbsp"}a.trigger("data",h)}),this.flush=function(){i.flush()},h=function(a,b){var c,d,e=8,f=8;for(c=0;a>c;c++)0!==f&&(d=b.readExpGolomb(),f=(e+d+256)%256),e=0===f?e:f},f=function(a){for(var b,c,d=a.byteLength,e=[],f=1;d-2>f;)0===a[f]&&0===a[f+1]&&3===a[f+2]?(e.push(f+2),f+=2):f++;if(0===e.length)return a;b=d-e.length,c=new Uint8Array(b);var g=0;for(f=0;b>f;g++,f++)g===e[0]&&(g++,e.shift()),c[f]=a[g];return c},g=function(a){var c,d,e,f,g,i,j,k,l,m,n,o,p=0,q=0,r=0,s=0;if(c=new b.ExpGolomb(a),d=c.readUnsignedByte(),f=c.readUnsignedByte(),e=c.readUnsignedByte(),c.skipUnsignedExpGolomb(),(100===d||110===d||122===d||244===d||44===d||83===d||86===d||118===d||128===d||138===d||139===d||134===d)&&(g=c.readUnsignedExpGolomb(),3===g&&c.skipBits(1),c.skipUnsignedExpGolomb(),c.skipUnsignedExpGolomb(),c.skipBits(1),c.readBoolean()))for(n=3!==g?8:12,o=0;n>o;o++)c.readBoolean()&&(6>o?h(16,c):h(64,c));if(c.skipUnsignedExpGolomb(),i=c.readUnsignedExpGolomb(),0===i)c.readUnsignedExpGolomb();else if(1===i)for(c.skipBits(1),c.skipExpGolomb(),c.skipExpGolomb(),j=c.readUnsignedExpGolomb(),o=0;j>o;o++)c.skipExpGolomb();return c.skipUnsignedExpGolomb(),c.skipBits(1),k=c.readUnsignedExpGolomb(),l=c.readUnsignedExpGolomb(),m=c.readBits(1),0===m&&c.skipBits(1),c.skipBits(1),c.readBoolean()&&(p=c.readUnsignedExpGolomb(),q=c.readUnsignedExpGolomb(),r=c.readUnsignedExpGolomb(),s=c.readUnsignedExpGolomb()),{profileIdc:d,levelIdc:e,profileCompatibility:f,width:16*(k+1)-2*p-2*q,height:(2-m)*(l+1)*16-2*r-2*s}}},k.prototype=new b.Stream,g=function(a){var b,c,d=0,e=[],f=0;g.prototype.init.call(this),delete a.minPTS,this.push=function(d){m(a,d),"seq_parameter_set_rbsp"!==d.nalUnitType||b||(b=d.config,a.width=b.width,a.height=b.height,a.sps=[d.data],a.profileIdc=b.profileIdc,a.levelIdc=b.levelIdc,a.profileCompatibility=b.profileCompatibility),"pic_parameter_set_rbsp"!==d.nalUnitType||c||(c=d.data,a.pps=[d.data]),e.push(d),f+=d.data.byteLength},this.flush=function(){var b,c,g,h,i,j,k,l,m;if(0!==f){for(k=new Uint8Array(f+4*e.length),l=new DataView(k.buffer),a.samples=[],m={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0}},j=0;e.length;)c=e[0],"access_unit_delimiter_rbsp"===c.nalUnitType&&(b&&(m.duration=c.dts-b.dts,a.samples.push(m)),m={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0},compositionTimeOffset:c.pts-c.dts},b=c),"slice_layer_without_partitioning_rbsp_idr"===c.nalUnitType&&(m.flags.dependsOn=2),m.size+=4,m.size+=c.data.byteLength,l.setUint32(j,c.data.byteLength),j+=4,k.set(c.data,j),j+=c.data.byteLength,e.shift();a.samples.length&&(m.duration=a.samples[a.samples.length-1].duration),a.samples.push(m),f=0,h=u.mdat(k),o(a),g=u.moof(d,[a]),i=new Uint8Array(g.byteLength+h.byteLength),d++,i.set(g),i.set(h,g.byteLength),n(a),this.trigger("data",{track:a,boxes:i})}}},g.prototype=new b.Stream,m=function(a,b){a.minDTS===c?a.minDTS=b.dts:a.minDTS=Math.min(a.minDTS,b.dts),a.maxDTS===c?a.maxDTS=b.dts:(b.dts-a.maxDTS>100&&(a.deltaDTS=b.dts-a.maxDTS),a.maxDTS=Math.max(a.maxDTS,b.dts))},n=function(a){delete a.minDTS,delete a.maxDTS,delete a.deltaDTS},o=function(a){var b,c=a.expectedBaseMediaDecodeTime,d=9e4;a.baseMediaDecodeTime=a.minDTS-a.earliestDTS,c&&c<a.baseMediaDecodeTime&&a.baseMediaDecodeTime-c<d&&(a.baseMediaDecodeTime=c),"audio"===a.type&&(b=a.samplerate/d,a.baseMediaDecodeTime*=b,a.baseMediaDecodeTime=Math.floor(a.baseMediaDecodeTime)),a.expectedBaseMediaDecodeTime=a.deltaDTS+a.maxDTS-a.earliestDTS},i=function(){var a,l,m,n,o,p,q,r,s,t,u=this,v={push:function(a){var c,d,e=a.track,f=a.boxes;c=b.mp4.initSegment([e]),d=new Uint8Array(c.byteLength+f.byteLength),d.set(c),d.set(f,c.byteLength),u.trigger("data",{type:e.type,data:d})}};i.prototype.init.call(this),n=new d,o=new e,p=new f,q=new j,r=new k,this.metadataStream=new b.mp2t.MetadataStream,n.pipe(o).pipe(p),p.pipe(q),p.pipe(r),p.pipe(this.metadataStream),p.on("data",function(b){var d;if(("audio"===b.type||"video"===b.type)&&(m=m===c?b.dts:Math.min(m,b.dts)),"metadata"===b.type)for(d=b.tracks.length;d--;)"video"!==b.tracks[d].type||s?"audio"!==b.tracks[d].type||t||(l=b.tracks[d],t=new h(l),q.pipe(t).pipe(v)):(a=b.tracks[d],s=new g(a),r.pipe(s).pipe(v))}),this.push=function(a){n.push(a)},this.flush=function(){p.flush(),r.flush(),s&&(a.earliestDTS=m,s.flush()),t&&(l.earliestDTS=m,t.flush()),this.trigger("done")}},i.prototype=new b.Stream,b.mp2t=b.mp2t||{},b.mp2t.PAT_PID=0,b.mp2t.MP2T_PACKET_LENGTH=p,b.mp2t.H264_STREAM_TYPE=q,b.mp2t.ADTS_STREAM_TYPE=r,b.mp2t.METADATA_STREAM_TYPE=s,b.mp2t.TransportPacketStream=d,b.mp2t.TransportParseStream=e,b.mp2t.ElementaryStream=f,b.mp2t.VideoSegmentStream=g,b.mp2t.Transmuxer=i,b.mp2t.AacStream=j,b.mp2t.H264Stream=k}(this,this.muxjs);var transmuxer=new muxjs.mp2t.Transmuxer;onmessage=function(a){if("push"===a.data.action){var b=new Uint8Array(a.data.data);transmuxer.push(b)}else"flush"===a.data.action&&transmuxer.flush()},transmuxer.on("data",function(a){postMessage({action:"data",type:a.type,data:a.data.buffer},[a.data.buffer])}),transmuxer.on("done",function(a){postMessage({action:"done"})});'],{
type:"application/javascript"}))),this.transmuxer_.onmessage=function(c){if("data"===c.data.action){var d=c.data;d.data=new Uint8Array(d.data),"video"===d.type?b.videoBuffer_||(b.videoBuffer_=a.addSourceBuffer_("video/mp4;codecs=avc1.4d400d")):b.audioBuffer_||(b.audioBuffer_=a.addSourceBuffer_("audio/mp4;codecs=mp4a.40.2")),b.pendingBuffers_.push(d)}else"done"===c.data.action&&b.processPendingSegments_()},Object.defineProperty(this,"updating",{get:function(){return this.bufferUpdating_||this.audioBuffer_&&this.audioBuffer_.updating||this.videoBuffer_&&this.videoBuffer_.updating}}),Object.defineProperty(this,"buffered",{get:function(){var a,b,c,d=[],e=[];return this.videoBuffer_&&0===this.videoBuffer_.buffered.length||this.audioBuffer_&&0===this.audioBuffer_.buffered.length?videojs.createTimeRange():(this.videoBuffer_&&(c=this.videoBuffer_.buffered.length-1,d.push(this.videoBuffer_.buffered.start(0)),e.push(this.videoBuffer_.buffered.end(c))),this.audioBuffer_&&(c=this.audioBuffer_.buffered.length-1,d.push(this.audioBuffer_.buffered.start(0)),e.push(this.audioBuffer_.buffered.end(c))),a=Math.max.apply(Math,d),b=Math.min.apply(Math,e),videojs.createTimeRange(a,b))}})},appendBuffer:function(a){this.bufferUpdating_=!0,this.transmuxer_.postMessage({action:"push",data:a.buffer},[a.buffer]),this.transmuxer_.postMessage({action:"flush"})},processPendingSegments_:function(){for(var a,b=[],c=[],d=0,e=0;a=this.pendingBuffers_.shift();)"video"===a.type?(b.push(a.data),d+=a.data.byteLength):(c.push(a.data),e+=a.data.byteLength);d&&this.concatAndAppendSegments_(b,d,this.videoBuffer_),e&&this.concatAndAppendSegments_(c,e,this.audioBuffer_),this.bufferUpdating_=!1},concatAndAppendSegments_:function(a,b,d){var e=0,f=new Uint8Array(b);a.forEach(function(a){f.set(a,e),e+=a.byteLength}),this.timestampOffset!==c&&(d.timestampOffset=this.timestampOffset),d.appendBuffer(f)}}),videojs.FlashMediaSource=videojs["extends"](j,{constructor:function(){this.sourceBuffers=[],this.readyState="closed",this.on(["sourceopen","webkitsourceopen"],function(a){this.swfObj=document.getElementById(a.swfId),this.readyState="open",this.swfObj&&this.swfObj.vjs_load()})}}),videojs.FlashMediaSource.BYTES_PER_SECOND_GOAL=4194304,videojs.FlashMediaSource.TICKS_PER_SECOND=60,videojs.FlashMediaSource.prototype.addSourceBuffer=function(a){var b;if("video/mp2t"!==a)throw new Error("NotSupportedError (Video.js)");return b=new videojs.FlashSourceBuffer(this),this.sourceBuffers.push(b),b},Object.defineProperty(videojs.FlashMediaSource.prototype,"duration",{get:function(){return this.swfObj?this.swfObj.vjs_getProperty("duration"):NaN},set:function(a){return this.swfObj.vjs_setProperty("duration",a),a}}),videojs.FlashMediaSource.prototype.endOfStream=function(){this.readyState="ended"},videojs.mediaSources={},videojs.MediaSource.open=function(a,b){var c=videojs.mediaSources[a];if(!c)throw new Error("Media Source not found (Video.js)");c.trigger({type:"sourceopen",swfId:b})},h=function(b){a.setTimeout(b,Math.ceil(1e3/videojs.FlashMediaSource.TICKS_PER_SECOND))},videojs.FlashSourceBuffer=videojs["extends"](j,{constructor:function(c){var d;this.buffer_=[],this.bufferSize_=0,this.source=c,this.updating=!1,this.segmentParser_=new b.SegmentParser,d=a.btoa(String.fromCharCode.apply(null,this.segmentParser_.getFlvHeader())),this.source.swfObj.vjs_appendBuffer(d),Object.defineProperty(this,"buffered",{get:function(){return videojs.createTimeRange(0,this.source.swfObj.vjs_getProperty("buffered"))}})},appendBuffer:function(a){var b,c;if(this.updating)throw b=new Error("SourceBuffer.append() cannot be called while an update is in progress"),b.name="InvalidStateError",b.code=11,b;0===this.buffer_.length&&h(this.processBuffer_.bind(this)),this.updating=!0,this.source.readyState="open",this.trigger({type:"update"}),c=this.tsToFlv_(a),this.buffer_.push(c),this.bufferSize_+=c.byteLength},abort:function(){this.buffer_=[],this.bufferSize_=0,this.source.swfObj.vjs_abort(),this.updating&&(this.updating=!1,this.trigger({type:"updateend"}))},processBuffer_:function(){var b,c,d,e,f;if(this.buffer_.length){for(e=document.hidden?videojs.FlashMediaSource.BYTES_PER_SECOND_GOAL:Math.ceil(videojs.FlashMediaSource.BYTES_PER_SECOND_GOAL/videojs.FlashMediaSource.TICKS_PER_SECOND),d=new Uint8Array(Math.min(e,this.bufferSize_)),c=d.byteLength;c;)b=this.buffer_[0].subarray(0,c),d.set(b,d.byteLength-c),b.byteLength<this.buffer_[0].byteLength?this.buffer_[0]=this.buffer_[0].subarray(c):this.buffer_.shift(),c-=b.byteLength;this.bufferSize_-=d.byteLength,f=a.btoa(String.fromCharCode.apply(null,d)),this.source.swfObj.CallFunction('<invoke name="vjs_appendBuffer"returntype="javascript"><arguments><string>'+f+"</string></arguments></invoke>"),0!==this.bufferSize_?h(this.processBuffer_.bind(this)):(this.updating=!1,this.trigger({type:"updateend"}),"ended"===this.source.readyState&&this.source.swfObj.vjs_endOfStream())}},tsToFlv_:function(a){var b,c,d,e=0,f=[];for(this.segmentParser_.parseSegmentBinaryData(a),this.segmentParser_.flushTags();this.segmentParser_.tagsAvailable();)f.push(this.segmentParser_.getNextTag());for(b=0;b<f.length;b++)e+=f[b].bytes.byteLength;for(d=new Uint8Array(e),b=0,c=0;b<f.length;b++)d.set(f[b].bytes,c),c+=f[b].bytes.byteLength;return d}}),videojs.URL={createObjectURL:function(b){var c;return b instanceof videojs.FlashMediaSource?(c=k+i,i++,videojs.mediaSources[c]=b,c):a.URL.createObjectURL(b)}}}(this,this.muxjs);